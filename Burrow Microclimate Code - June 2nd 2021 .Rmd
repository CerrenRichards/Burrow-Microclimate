---
title: "Burrow microclimate code"
author: "Cerren Richards"
date: "02/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```


## Combine all the files

- Combine all the separate burrow .csv files
- Correct the data and times
- Match the metadata

```{r}
# Read in metadata and corrected date and times for the data
metadata <- read.csv("metadata.csv")
datetime <- read.csv("dateandtimes.csv")


# Read in all the files at once
# Make a list of all the .csv files
files <- list.files(pattern="*.csv")

# First apply read.csv, then rbind
temps <- do.call(rbind, lapply(files, function(x) read.csv(x, stringsAsFactors = FALSE)))

# Remove the origional date and times because they are in different formats
temps$Date <- NULL 
temps$Time <- NULL

# Join the corrected date and times to the `temps` dataframe
temps <- cbind(temps, datetime)

# Join the metadata to the `temps` dataframe
temps <- left_join(temps, metadata, by = "Name")

```


## Plot over the whole study 

Create a plot showing the mean and standard deviation temperature variation through the season 
```{r}

## Filter the inside and outside data to separate dataframes
inside <- filter(temps, Location  == "Inside")
outside <- filter(temps, Location  == "Outside")


## Summarise the mean temperature and standard deviation for inside the burrow
inside_mean <- inside %>%
  group_by(Date, Time) %>%
  summarise(mean = mean(Temperature), sd = sd(Temperature))

## Make plot in ggplot
library(ggplot2)

ggplot(inside_mean)+
  geom_point(aes(x = Time, y = mean))
  geom_line(aes(x =julian, y = diff, colour = ISO3))+
  theme(legend.position = "none")
  
  
  
#__________
  
temps$datetime <- as.POSIXct(paste(temps$Date, temps$Time), format="%d-%m-%Y %H:%M:%S")


# Summarise the mean temperature and standard deviation for inside and outside the burrows
season_mean_temp <- temps %>%
  group_by(Location, datetime) %>%
  summarise(mean = mean(Temperature), sd = sd(Temperature),
            n = n(), se = sd/sqrt(n))


# Plot inside
ggplot(data = filter(season_mean_temp, Location == "Outside"), aes(x = datetime, y = mean))+
  geom_line()+
  geom_pointrange(aes(ymin=mean-sd, ymax=mean+sd))+
  geom_point(shape = 21, alpha = 0.2, size = 1)+
  theme_bw(base_size = 15)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  xlab("Date") + ylab("Temperature (°C)")+
  theme(axis.title.y = element_text(vjust = 3))+
  theme(axis.title.x = element_text(vjust = -1)) +
  theme(legend.position = c(0.15, 0.75))




```

## Plot for mean temp

```{r}

# Summarise the mean temperature and standard deviation for inside and outside the burrows
mean_temp <- temps %>%
  group_by(Location, Hour) %>%
  summarise(mean = mean(Temperature), sd = sd(Temperature),
            n = n(), se = sd/sqrt(n))


# Plot
ggplot(mean_temp, aes(x = Hour, y = mean, group = Location))+
  geom_line()+
  geom_pointrange(aes(ymin=mean-sd, ymax=mean+sd))+
  geom_point(size = 3,shape = 21, aes(fill = Location))+
  scale_fill_manual(values=c('black','white'))+
  theme_bw(base_size = 15)+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+
  xlab("Time of Day (h)") + ylab("Temperature (°C)")+
  scale_x_continuous(breaks=seq(0,23,2))+
  theme(axis.title.y = element_text(vjust = 3))+
  theme(axis.title.x = element_text(vjust = -1)) +
  theme(legend.position = c(0.15, 0.75))




```



