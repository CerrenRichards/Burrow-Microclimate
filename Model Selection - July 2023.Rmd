---
title: "Appendix 1 - Model Selection Procedure for Drivers of Burrow Microclimate"
subtitle: "Burrows buffer nest temperatures and offer a stable thermal microclimate for threatened seabird chicks during extreme events"
author: '[Cerren Richards](https://www.cerrenrichards.com)'
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}

lssp <- read.csv("lssp.csv")

lssp$Burrow <- factor(lssp$Burrow)

library(DHARMa); library(lme4); library(mgcViz); library(mgcv);library(dsm);library(dplyr)

```


# PETREL MODEL - correlates of burrow microclimate

Here we show the steps followed to test for correlation between external environmental conditions and petrel burrow thermal environment.

We tested a variety of models including GAM, BAM, and GAMM. Additionally we tried different methods of accounting for autocorrelation. 


## Initial Models

Run three initial models to identify whether the weather variables should be fitted as spline terms, a spline interaction term or linear interaction term. 

```{r, warning = FALSE, message=FALSE}

# Model with spline fits
m1_petrel <- gam(data = lssp,
           Inside~s(scale(Temperature), bs="ts") + # Weather 
                  s(scale(Wind.Speed),bs="ts") +  # Weather
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 


# Explore temp-wind interaction term
m2_petrel <- gam(data = lssp,
           Inside~s(scale(Temperature), scale(Wind.Speed)) +
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 


# Explore Linear interaction 
m3_petrel <- gam(data = lssp,
           Inside~scale(Temperature) * scale(Wind.Speed) + 
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 

```

**Compare AIC**

Spline interaction (`m2_petrel`) has the lowest AIC score.

```{r}
AIC(m1_petrel, m2_petrel, m3_petrel)
```



**Model Summary**
```{r, echo=FALSE}

summary(m2_petrel)

```

## Increase the knots for Julian date

From the summary table of `m2_petrel`, the edf is close to the ref.df, indicating that the knots may need to be increased. Here we double the knots to 20.

```{r, warning = FALSE, message=FALSE}

m4_petrel <- gam(data = lssp,
           Inside~s(scale(Temperature), scale(Wind.Speed)) +
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts", k = 20) + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 

```


**Model Summary**
```{r, echo=FALSE}

summary(m4_petrel)

```

## Increase the knots again for Julian date
```{r, warning = FALSE, message=FALSE}

m5_petrel <- gam(data = lssp,
           Inside~s(scale(Temperature), scale(Wind.Speed)) +
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts", k = 40) + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 

```

**Model Summary**

From the summary of `m5_petrel`, the edf continues to be close to the ref.df value, but we are unable to increase the knots further.

```{r, echo=FALSE}

summary(m5_petrel)

```

**Compare AIC**

Model `m5_petrel` with k = 40 has the lowest AIC score. 

```{r}
AIC(m2_petrel, m4_petrel, m5_petrel)
```


## Explore model fit

**Test for temporal autocorrelation**

The model `m5_petrel` is highly autocorrelated, therefore, we reject this model. Next we will explore a `bam` model instead.
```{r}
acf(residuals(m5_petrel))
```


## `BAM` model

```{r}

## No data were recorded from the forest plot weather station at 2021-09-11 08:30:00. 
## The following code needs equal number of rows to run the model.
## We will therefore filter out the data at this timepoint for the open plot burrows.
lssp2 <- lssp %>% filter(datetime != "2021-09-11 08:30:00") 


# Model formulae
base_form <- Inside ~ s(scale(Temperature), scale(Wind.Speed)) +
  s(Time, bs = "cc") +
  s(julian, bs = "ts", k = 40)
# add the random effect for use in bam(). It is specified differently in gamm()
form <- update(base_form, . ~ . + s(Burrow, bs = "re") )

# Now deal with autocorrelation.
# First time through with no AR(1) process to get initial rho estimate
bam0_petrel <- bam(formula = form, data = lssp2, method = "REML")
acf.vals <- acf(residuals(bam0_petrel))


# We will use the estimated autocorrelation at lag 1 from the plot as our initial
# value of rho.
init.rho <- acf.vals$acf[2]

# Unlike gamm(), we need to explicitly tell bam() about the structure of the 
# data, that the data for each petrel burrow is 2172 rows long. We create a vector
# ar.strt to pass as the AR.start parameter to bam(). This vector has a TRUE
# at the position where each burrow's data starts, that is, every 2172 rows
# in our case.
nBurrow <- length(unique(lssp2$Burrow))
ar.strt <- rep(c(TRUE, rep(FALSE, (nrow(lssp2)/nBurrow) - 1)), 
               length(unique(lssp2$Burrow)))

# Set up a vector called rho to contain all the values we'd like to try for the
# autocorrelation parameter. We will try all values from 90% to 110% of the 
# initial value computed above, with a step of 0.01 between each one.
# 
# The idea is to re-run the model with each value of rho and find the 
# one with the minimum REML score.
# 
# The "REML <- " part in the next line is just to initialize REML as a vector
# of the same length as rho.
REML <- rho <- seq(from = round(init.rho * 0.9, 2), 
         to = min(0.99, round(init.rho * 1.1, 2)),
         by = 0.01)

# Run each model
for(i in 1:length(rho)) {
  message("Doing rho = ", rho[i])
  bam1_petrel <- bam(
    formula = form,
    rho = rho[i],
    AR.start = ar.strt,
    data = lssp2,
    method = "REML"
  )
  REML[i] <- bam1_petrel$gcv.ubre # Save the REML score
}


# Now add it to the final model
bam2_petrel <- bam(
    formula = form,
    rho = rho[which.min(REML)],
    AR.start = ar.strt,
    data = lssp2,
    method = "REML"
)


```


**Model Summary - BAM**
```{r, echo=FALSE}

summary(bam2_petrel)

```


## Explore model fit

**Test for temporal autocorrelation**

Correlated residuals

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
acf(residuals(bam2_petrel))
```

These are the uncorrelated residuals after applying AR(1)

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
acf(bam2_petrel$std.rsd)
```


**Gam.check**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}

gam.check(bam2_petrel)

```


**Plotting**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
plot(bam2_petrel, scheme = 2)
```



## `GAMM` with corAR1

We will also explore the GAMM option with burrow as a random effect and include a corAR1 term to account for autocorrelation. We removed the date and time terms because the corAR1 term is accounting for the autocorrelation. 

```{r, include=FALSE}

gamm1_petrel <- gamm(data = lssp,
                   Inside~s(scale(Temperature), scale(Wind.Speed)),
                   random = list(Burrow = ~1),# Burrow features
                   corr = corAR1(form = ~ 1|Burrow),
                   method = "REML")

```

**Model Summary - gam**
```{r, echo=FALSE}

summary(gamm1_petrel$gam)

```

**Model Summary - lme**
```{r, echo=FALSE}

summary(gamm1_petrel$lme)

```

## Explore model fit

**Test for temporal autocorrelation**

The residual function for gam in R returns the residuals without adjustment for the correlation structure. So must specify type = "normalized"
```{r}
acf(residuals(gamm1_petrel$lme, type = "normalized"))
```


**Gam.check**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}

gam.check(gamm1_petrel$gam)

```



**lme plot**

``````{r, out.width = '60%', fig.align = "center"}

plot(gamm1_petrel$lme)

```



**Visualise the temp-wind interaction in 2D**

``````{r, out.width = '60%', fig.align = "center"}

plot(gamm1_petrel$gam, scheme = 2, pages = 1)

```



**Visualise the temp-wind interaction in 3D**

Internal burrow temperature increases with external air temperature. However, there is a non-linear interaction effect between wind speed and temperature, where internal burrow temperature decreases with increasing wind speed while external air temperatures are low, but increases with wind speed while air temperature is high. 

These plots are identical, but have been rotated to view the data from different angles. Low values of internal burrow temperatures (linear predictor) are red and high values are yellow.

```{r, echo=FALSE, fig.align = "center", warning=FALSE}

# The code for the 3D plot below will not run unless the data are scaled beforehand 
# So we will scale the data in the dataframe and rerun the model so that the variables match


# Scale the data before hand
lssp$Temperature. <- scale(lssp$Temperature)
lssp$Wind.Speed. <- scale(lssp$Wind.Speed)

# run the model
m11_petrel <- gamm(data = lssp,
                   Inside~s(Temperature., Wind.Speed.),
                   random = list(Burrow = ~1),# Burrow features
                   corr = corAR1(form = ~ 1|Burrow),
                   method = "REML")


# Create the two plots side-by-side
par(mfrow = c(1,2))

# Plot Rotation 1
vis.gam(m11_petrel$gam, view = c("Temperature.", "Wind.Speed."),
    theta = 100, n.grid = 40, lwd = 0.4, too.far = 0.1)

# Plot Rotation 2
vis.gam(m11_petrel$gam, view = c("Temperature.", "Wind.Speed."),
    theta = 550, n.grid = 40, lwd = 0.4, too.far = 0.1)

par(mfrow = c(1, 1))


```






# PUFFIN MODEL - correlates of burrow microclimate

Here we show the modelling steps followed to arrive at the final selected model used to test correlates of Atlantic puffin burrow microclimates.  


```{r, include=FALSE}
atpu <- read.csv("atpu.csv")

atpu$Burrow <- factor(atpu$Burrow)

```


## Exploring wind speed

In the plot below, the data for wind speed exceed the speeds recorded during the hurricane, suggesting that there may be issues with data at these three points. They occurred all on the same day over a 1.5 hour period. 

```{r, out.width = '60%', fig.align = "center"}
plot(atpu$Wind.Speed, atpu$Inside)
```

**Removing potentially erroneous data**

We will remove the high wind speed records for the modelling.

```{r, out.width = '60%', fig.align = "center"}
# Remove the higher wind speeds
atpu.wind <- atpu %>% filter(Wind.Speed < 30)

# Visualise the data
plot(atpu.wind$Wind.Speed, atpu.wind$Inside)
```


## Initial models

Run three initial models to identify whether the weather variables should be fitted as spline terms, a spline interaction term or linear interaction term. 

```{r, warning = FALSE, message=FALSE}

# Model with spline fits
m1_puffin <- gam(data = atpu.wind,
           Inside~s(scale(Temperature), bs="ts") + # Weather 
                  s(scale(Wind.Speed),bs="ts") +  # Weather
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 


# Explore temp-wind interaction term
m2_puffin <- gam(data = atpu.wind,
           Inside~s(scale(Temperature), scale(Wind.Speed)) +
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 


# Explore Linear interaction 
m3_puffin <- gam(data = atpu.wind,
           Inside~scale(Temperature) * scale(Wind.Speed) + 
                  s(Time, bs="cc") + # Time
                  s(julian, bs="ts") + # Date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 


```

**Compare AIC**

Spline interaction (`m2_puffin`) has the lowest AIC score

```{r}
AIC(m1_puffin, m2_puffin, m3_puffin)
```



**Model Summary**
```{r, echo=FALSE}

summary(m2_puffin)

```


## Increase the knots for Julian date

From the summary table of `m2_puffin`, the edf is close to the ref.df, indicating that the knots may need to be increased. Here we double the knots to 20. 

```{r}
m4_puffin <- gam(data = atpu.wind,
             Inside~s(scale(Temperature), scale(Wind.Speed)) +
                  s(Time, bs="cc") + 
                  s(julian, bs="ts", k = 20)+ # Time and date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 
```


**Model Summary**

The edf continues to be close to the ref.df value, but we are unable to increase the knots further. 

```{r, echo=FALSE}

summary(m4_puffin)

```

**Compare AIC**

Increasing the knots reduces the AIC score. 

```{r}
AIC(m2_puffin, m4_puffin)
```


## Increase the knots for the interaction term

From the summary table of `m4_puffin`, the edf is close to the ref.df, indicating that the knots may need to be increased. Here we double to knots to 60. 

```{r}
m5_puffin <- gam(data = atpu.wind,
             Inside~s(scale(Temperature), scale(Wind.Speed), k = 60) +
                  s(Time, bs="cc") + 
                  s(julian, bs="ts", k = 20)+ # Time and date
                  s(Burrow, bs="re"), # random effect
                  method = "REML") 
```


**Model Summary**
```{r, echo=FALSE}

summary(m5_puffin)

```

**Compare AIC**

Increasing the knots reduces the AIC score. We will now explore the model fit.

```{r}
AIC(m4_puffin, m5_puffin)
```


## Explore model fit

**Test for temporal autocorrelation**

The model `m5_puffin` is highly autocorrelated, therefore, we reject this model. Next we will explore a `bam` model instead.

```{r}
acf(residuals(m5_puffin))
```



## `BAM` model

```{r}
# Model formulae. 

base_form <- Inside ~ s(Temperature, Wind.Speed, k = 60) +
  s(Time, bs = "cc") +
  s(julian, bs = "ts", k = 20)
# add the random effect for use in bam(). It is specified differently in gamm()
form <- update(base_form, . ~ . + s(Burrow, bs = "re") )


# Now deal with autocorrelation.
# First time through with no AR(1) process to get initial rho estimate
bam0_puffin <- bam(formula = form, data = atpu.wind, method = "REML")
summary(bam0_puffin)
acf.vals <- acf(residuals(bam0_puffin))


# We will use the estimated autocorrelation at lag 1 from the plot as our initial
# value of rho.
init.rho <- acf.vals$acf[2]

# Unlike gamm(), we need to explicitly tell bam() about the structure of the 
# data, that the data for each burrow is 1548 rows long. We create a vector
# ar.strt to pass as the AR.start parameter to bam(). This vector has a TRUE
# at the position where each burrow's data starts, that is, every 1548 rows
# in our case.
nBurrow <- length(unique(atpu.wind$Burrow))
ar.strt <- rep(c(TRUE, rep(FALSE, (nrow(atpu.wind)/nBurrow) - 1)), 
               length(unique(atpu.wind$Burrow)))

# Set up a vector called rho to contain all the values we'd like to try for the
# autocorrelation parameter. We will try all values from 90% to 110% of the 
# initial value computed above, with a step of 0.01 between each one.
# 
# The idea is to re-run the model with each value of rho and find the 
# one with the minimum REML score.
# 
# The "REML <- " part in the next line is just to initialize REML as a vector
# of the same length as rho.
REML <- rho <- seq(from = round(init.rho * 0.9, 2), 
         to = min(0.99, round(init.rho * 1.1, 2)),
         by = 0.01)

# Run each model
for(i in 1:length(rho)) {
  message("Doing rho = ", rho[i])
  bam1_puffin <- bam(
    formula = form,
    rho = rho[i],
    AR.start = ar.strt,
    data = atpu.wind,
    method = "REML"
  )
  REML[i] <- bam1_puffin$gcv.ubre # Save the REML score
}


# Now add it to the final model
bam2_puffin <- bam(
    formula = form,
    rho = rho[which.min(REML)],
    AR.start = ar.strt,
    data = atpu.wind,
    method = "REML"
)

```



**Model Summary - BAM**
```{r, echo=FALSE}

summary(bam2_puffin)

```


## Explore model fit

**Test for temporal autocorrelation**

Correlated residuals

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
acf(residuals(bam2_puffin))
```

These are the uncorrelated residuals after applying AR(1)

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
acf(bam2_puffin$std.rsd)
```


**Gam.check**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}

gam.check(bam2_puffin)

```


**Plotting**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}
plot(bam2_puffin, scheme = 2)
```



## `GAMM` with corAR1

We will also explore the GAMM option with burrow as a random effect and include a corAR1 term to account for autocorrelation. We removed the date and time terms because the corAR1 term is accounting for the autocorrelation. 

```{r, include=FALSE}

gamm1_puffin <- gamm(data = atpu.wind,
                   Inside~s(scale(Temperature), scale(Wind.Speed)),
                   random = list(Burrow = ~1),# Burrow features
                   corr = corAR1(form = ~ 1|Burrow),
                   method = "REML")

```

**Model Summary - gam**
```{r, echo=FALSE}

summary(gamm1_puffin$gam)

```

**Model Summary - lme**
```{r, echo=FALSE}

summary(gamm1_puffin$lme)

```

## Explore model fit

**Test for temporal autocorrelation**

The residual function for gam in R returns the residuals without adjustment for the correlation structure. So must specify type = "normalized"
```{r}
acf(residuals(gamm1_puffin$lme, type = "normalized"))
```


**Gam.check**

```{r, fig.height = 15, fig.width = 15, fig.align = "center"}

gam.check(gamm1_puffin$gam)

```



**lme plot**

``````{r, out.width = '60%', fig.align = "center"}

plot(gamm1_puffin$lme)

```



**Visualise the temp-wind interaction in 2D**

``````{r, out.width = '60%', fig.align = "center"}

plot(gamm1_puffin$gam, scheme = 2, pages = 1)

```

















####_____________________________________________________________________
#### Scrap code






# Original model

```{r , include=FALSE}
library(DHARMa); library(lme4); library(mgcViz); library(mgcv);library(dsm);library(dplyr)


# Read data
atpu.wind <- read.csv("atpu.wind.csv")

# Set as factor
atpu$Burrow <- factor(atpu$Burrow)

# Model so far
m6_puffin <- gam(data = atpu.wind,
                 Inside~s(scale(Temperature), scale(Wind.Speed), k = 60) +
                   s(Time, bs="cc") + 
                   s(julian, bs="ts", k = 20)+ # Time and date
                   s(Burrow, bs="re"), # random effect
                 method = "REML") 


## TEST FOR AUTOCORRELATION
# Lots of useful info in the ?testTemporalAutocorrelation help file

# Assign a date-time column 
atpu$datetime2 <- as.POSIXct(atpu$datetime, format='%Y-%m-%d %H:%M')
atpu.wind$datetime2 <- as.POSIXct(atpu.wind$datetime, format='%Y-%m-%d %H:%M')

# Simulate the residuals for the model
res <- simulateResiduals(m6_puffin)
#res <- recalculateResiduals(res, group = atpu.wind$datetime2, rotation = "estimated")
res <- recalculateResiduals(res, group = atpu.wind$datetime2)

# Test for temporal autocorrelation
# Clear autocorrelation present
testTemporalAutocorrelation(res, time = unique(atpu.wind$datetime2))

# Other autocorrelation test method
acf(residuals(m6_puffin))

```



## GAMM with corAR1

```{r, include=FALSE}
m10_puffin <- gamm(data = atpu.wind,
                   Inside~s(scale(Temperature), scale(Wind.Speed), k = 60) +
                   random = list(Burrow = ~1),# Burrow features
                   corr = corAR1(form = ~ 1|Burrow),
                   method = "REML")


# The residual function for gam in R returns the residuals without adjustment for the correlation structure.
# So must specify "normalized"
acf(residuals(m10_puffin$lme, type = "normalized"))

```





```{r setup, include=FALSE}
library(DHARMa); library(lme4); library(mgcViz); library(mgcv);library(dsm);library(dplyr)


# Read data
atpu.wind <- read.csv("atpu.wind.csv")

# Set as factor
atpu.wind$Burrow <- factor(atpu.wind$Burrow)

```

# BAM

```{r, include=FALSE}
# Model formulae. Set it up so that we can use base_form in a comparative GAMM
# at the end for comparison. 
base_form <- Inside ~ s(Temperature, Wind.Speed, k = 60) +
  s(Time, bs = "cc") +
  s(julian, bs = "ts", k = 33)
# add the random effect for use in bam(). It is specified differently in gamm()
form <- update(base_form, . ~ . + s(Burrow, bs = "re") )

# Normally you would iterate through lots of times until you get the model 
# structure you want.

# Now deal with autocorrelation.
# First time through with no AR(1) process to get initial rho estimate
bam0 <- bam(formula = form, data = atpu.wind, method = "REML")
summary(bam0)
acf.vals <- acf(residuals(bam0))


# We will use the estimated autocorrelation at lag 1 from the plot as our initial
# value of rho.
init.rho <- acf.vals$acf[2]

# Unlike gamm(), we need to explicitly tell bam() about the structure of the 
# data, that the data for each burrow is 1548 rows long. We create a vector
# ar.strt to pass as the AR.start parameter to bam(). This vector has a TRUE
# at the position where each burrow's data starts, that is, every 1548 rows
# in our case.
nBurrow <- length(unique(atpu.wind$Burrow))
ar.strt <- rep(c(TRUE, rep(FALSE, (nrow(atpu.wind)/nBurrow) - 1)), 
               length(unique(atpu.wind$Burrow)))

# Set up a vector called rho to contain all the values we'd like to try for the
# autocorrelation parameter. We will try all values from 90% to 110% of the 
# initial value computed above, with a step of 0.01 between each one.
# 
# The idea is to re-run the model with each value of rho and find the 
# one with the minimum REML score.
# 
# The "REML <- " part in the next line is just to initialize REML as a vector
# of the same length as rho.
REML <- rho <- seq(from = round(init.rho * 0.9, 2), 
         to = min(0.99, round(init.rho * 1.1, 2)),
         by = 0.01)

# Run each model
for(i in 1:length(rho)) {
  message("Doing rho = ", rho[i])
  bam1 <- bam(
    formula = form,
    rho = rho[i],
    AR.start = ar.strt,
    data = atpu.wind,
    method = "REML"
  )
  REML[i] <- bam1$gcv.ubre # Save the REML score
}

# Plot the REML scores vs rho, check visually for a minima
plot(rho, REML)

# Use rho corresponding to lowest REML score 
message("Chose rho = ", rho[which.min(REML)])

# Now add it to the final model
bam3 <- bam(
    formula = form,
    rho = rho[which.min(REML)],
    AR.start = ar.strt,
    data = atpu.wind,
    method = "REML"
)


AIC(bam2, bam3)

summary(bam2)
acf(residuals(bam2)) # Correlated residuals
acf(bam3$std.rsd) # These are the uncorrelated residuals after applying AR(1) .
plot(bam2,scheme = 2)
hist(resid(bam3))
gam.check(bam3)

vis.gam(bam3, view = c("Temperature", "Wind.Speed"),
    theta = 700, n.grid = 40, lwd = 0.4, too.far = 0.1)

#Compare to same GAMM - almost identical.
mgamm <- gamm(formula = base_form,
              data = atpu.wind,
              random = list(Burrow = ~1),# Burrow features
              corr = corAR1(),
              method = "REML")
summary(mgamm$lme)
acf(residuals(mgamm$lme, type = "normalized"))



res <- simulateResiduals(bam3)
testDispersion(res)
testUniformity(res)
testOutliers(res)
simulateResiduals(bam3, plot = T)

atpu.wind$datetime2 <- as.POSIXct(atpu.wind$datetime, format='%Y-%m-%d %H:%M')
res <- recalculateResiduals(res, group = atpu.wind$datetime2)


plot(res)

plot(atpu.wind$julian, atpu.wind$resid)
plot(atpu.wind$Time, atpu.wind$resid)
plot(atpu.wind$Wind.Speed, atpu.wind$resid)
plot(atpu.wind$Temperature, atpu.wind$resid)

atpu.wind$resid <- residuals(bam3)
plot(atpu.wind$Inside, atpu.wind$resid)

plot(atpu.wind$volume, atpu.wind$resid)
plot(atpu.wind$volume, atpu.wind$Inside)
```



